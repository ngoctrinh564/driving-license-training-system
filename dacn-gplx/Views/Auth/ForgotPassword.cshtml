@using dacn_gplx.ViewModels
@model ForgotPasswordViewModel

<h2>Quên Mật Khẩu</h2>

<!-- THÔNG BÁO LỖI -->
@if (!ViewData.ModelState.IsValid)
{
    <div class="alert alert-danger">
        @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
        {
            <div>@error.ErrorMessage</div>
        }
    </div>
}

<!-- THÔNG BÁO THÀNH CÔNG -->
@if (ViewBag.Message != null)
{
    <div class="alert alert-success">@ViewBag.Message</div>
}

<hr />

<!-- ========================================================= -->
<!-- ⭐ BƯỚC 1: FORM GỬI OTP (chỉ hiện khi chưa gửi OTP)       -->
<!-- ========================================================= -->
@if (ViewBag.ShowOtpForm != true)
{
    <form method="post" asp-action="ForgotPassword">
        <div class="mb-3">
            <label asp-for="Username" class="form-label">Username hoặc Email</label>
            <input asp-for="Username" class="form-control" placeholder="Nhập username hoặc email" />
        </div>

        <button type="submit" class="btn btn-warning">Gửi OTP</button>
        <a asp-action="Login" asp-controller="Auth" class="btn btn-secondary ms-2">Quay lại đăng nhập</a>
    </form>
}

<!-- ========================================================= -->
<!-- ⭐ BƯỚC 2: NHẬP OTP                                       -->
<!-- ========================================================= -->
@if (ViewBag.ShowOtpForm == true && ViewBag.ShowPasswordForm != true)
{
    <h3>Nhập mã OTP</h3>

    <form method="post" asp-action="ForgotPassword">

        <input type="hidden" asp-for="Username" />

        <div class="mb-3">
            <label class="form-label">Mã OTP</label>
            <input name="otp" class="form-control" placeholder="Nhập mã OTP" />
        </div>

        <button type="submit" class="btn btn-primary">Xác thực OTP</button>
        <a asp-action="Login" asp-controller="Auth" class="btn btn-secondary ms-2">Quay lại đăng nhập</a>
    </form>
}

<!-- ========================================================= -->
<!-- ⭐ BƯỚC 3: ĐỔI MẬT KHẨU MỚI                               -->
<!-- ========================================================= -->
@if (ViewBag.ShowPasswordForm == true)
{
    <h3>Đổi mật khẩu mới</h3>

    <form method="post" asp-action="ForgotPassword">

        <input type="hidden" asp-for="Username" />

        <div class="mb-3">
            <label class="form-label">Mật khẩu mới</label>
            <input name="newPassword" type="password" class="form-control" placeholder="Nhập mật khẩu mới" />
        </div>

        <div class="mb-3">
            <label class="form-label">Xác nhận mật khẩu</label>
            <input name="confirmPassword" type="password" class="form-control" placeholder="Xác nhận mật khẩu" />
        </div>

        <button type="submit" class="btn btn-success">Đổi mật khẩu</button>
        <a asp-action="Login" asp-controller="Auth" class="btn btn-secondary ms-2">Quay lại đăng nhập</a>
    </form>
}


@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
