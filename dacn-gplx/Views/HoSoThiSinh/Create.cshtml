@model dacn_gplx.ViewModels.HoSoThiSinhViewModel

@{
    ViewData["Title"] = "Tạo hồ sơ";
}

<h2 class="mb-4">Tạo hồ sơ mới</h2>

<form asp-action="Create" method="post" enctype="multipart/form-data" class="border p-4 shadow-sm rounded">

    <!-- HẠNG GPLX -->
    <div class="mb-3">
        <label class="form-label fw-bold">Hạng GPLX</label>
        <select asp-for="HangId" class="form-select" required>
            <option value="">-- Chọn hạng GPLX --</option>
            @foreach (var hang in ViewBag.HangGPLX)
            {
                <option value="@hang.HangId">@hang.Tenhang</option>
            }
        </select>
    </div>

    <!-- GHI CHÚ -->
    <div class="mb-3">
        <label class="form-label fw-bold">Ghi chú</label>
        <textarea asp-for="Ghichu" class="form-control"></textarea>
    </div>

    <hr />

    <!-- THÔNG TIN KSK -->
    <h4 class="fw-bold mt-3">Thông tin Giấy khám sức khỏe</h4>

    <!-- NGÀY KHÁM -->
    <div class="mb-3">
        <label class="form-label fw-bold">Ngày ký / Ngày khám</label>
        <input asp-for="Thoihan"
               type="date"
               class="form-control"
               id="ngayKyInput"
               max="@DateTime.Today.ToString("yyyy-MM-dd")"
               required />
        <small class="text-danger d-none" id="ngayError">❌ Ngày khám không được lớn hơn hiện tại!</small>
    </div>

    <!-- NGÀY HẾT HẠN -->
    <div class="mb-3">
        <label class="form-label fw-bold">Ngày hết hạn</label>
        <input type="text" id="ngayHetHanDisplay" class="form-control bg-light" readonly />
    </div>

    <!-- HIỆU LỰC -->
    <div class="mb-3">
        <label class="form-label fw-bold">Hiệu lực</label>
        <input value="12 tháng" class="form-control bg-light" readonly />
    </div>

    <!-- KHÁM MẮT -->
    <div class="row">
        <div class="col-md-6 mb-3">
            <label class="fw-bold">Mắt trái</label>
            <input asp-for="KhamMatTrai" class="form-control" placeholder=".../..." required pattern="^[0-9]{1,2}/[0-9]{1,2}$" />
            <small class="text-muted">Định dạng: x/y</small>
        </div>

        <div class="col-md-6 mb-3">
            <label class="fw-bold">Mắt phải</label>
            <input asp-for="KhamMatPhai" class="form-control" placeholder=".../..." required pattern="^[0-9]{1,2}/[0-9]{1,2}$" />
        </div>
    </div>

    <!-- HUYẾT ÁP -->
    <div class="row">
        <div class="col-md-6 mb-3">
            <label class="fw-bold">Huyết áp</label>
            <input asp-for="Huyetap" class="form-control" placeholder="120/80" required pattern="^[0-9]{2,3}/[0-9]{2,3}$" />
        </div>

        <div class="col-md-6 mb-3">
            <label class="fw-bold">Chiều cao (cm)</label>
            <input asp-for="Chieucao" type="number" min="30" max="250" step="0.1" class="form-control" required />
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-3">
            <label class="fw-bold">Cân nặng (kg)</label>
            <input asp-for="Cannang" type="number" min="10" max="300" step="0.1" class="form-control" required />
        </div>
    </div>

    <!-- ẢNH -->
    <div class="mb-4">
        <label class="form-label fw-bold">Ảnh giấy khám sức khỏe</label>
        <input asp-for="AnhGkskFiles" type="file" multiple class="form-control" required />
        <small class="text-muted">Cho phép tối đa 10 ảnh, định dạng: JPG, PNG, WEBP</small>
    </div>

    <button type="submit" class="btn btn-success">Tạo hồ sơ</button>
    <a href="/HoSoThiSinh" class="btn btn-secondary">Hủy</a>

</form>

<script>
    const inputNgayKy = document.getElementById("ngayKyInput");
    const displayHetHan = document.getElementById("ngayHetHanDisplay");
    const ngayError = document.getElementById("ngayError");

    inputNgayKy.addEventListener("change", () => {
        let chosen = new Date(inputNgayKy.value);
        let today = new Date();

        if (chosen > today) {
            ngayError.classList.remove("d-none");
            inputNgayKy.value = "";
            displayHetHan.value = "";
            return;
        }

        ngayError.classList.add("d-none");

        let hetHan = new Date(chosen);
        hetHan.setMonth(hetHan.getMonth() + 12);

        let yyyy = hetHan.getFullYear();
        let mm = String(hetHan.getMonth() + 1).padStart(2, '0');
        let dd = String(hetHan.getDate()).padStart(2, '0');

        displayHetHan.value = `${yyyy}-${mm}-${dd}`;
    });
</script>
