@model List<dacn_gplx.ViewModels.HoSoThiSinhViewModel>

@{
    ViewData["Title"] = "Danh sách hồ sơ";
}

<h2 class="mb-4">Danh sách hồ sơ của bạn</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <a href="/HoSoThiSinh/Create" class="btn btn-primary">+ Tạo hồ sơ mới</a>

    <form method="get" class="d-flex align-items-center">
        <label class="me-2 fw-bold">Lọc theo trạng thái:</label>

        <select name="status" class="form-select" style="width: 220px;" onchange="this.form.submit()">
            @{
                string current = ViewBag.StatusFilter as string ?? "All";
            }

            <option value="All" selected="@(current == "All")">Tất cả</option>
            <option value="Đang xử lý" selected="@(current == "Đang xử lý")">Đang xử lý</option>
            <option value="Đã duyệt" selected="@(current == "Đã duyệt")">Đã duyệt</option>
            <option value="Từ chối" selected="@(current == "Từ chối")">Từ chối</option>
        </select>
    </form>
</div>

<div class="row">
    @foreach (var item in Model)
    {
        <div class="col-md-4 mb-4">
            <div class="card shadow-sm border-0" style="border-radius:10px;">
                <div class="card-body">

                    <h5 class="card-title fw-bold">@item.Tenhoso</h5>

                    <p class="mb-1"><b>Hạng GPLX:</b> @item.TenHang</p>
                    <p class="mb-1"><b>Ngày đăng ký:</b> @item.Ngaydangky?.ToString("dd/MM/yyyy")</p>

                    <p class="mt-2">
                        <b>Trạng thái:</b>
                        @{
                            string badgeClass = item.Trangthai switch
                            {
                                "Đang xử lý" => "badge bg-warning text-dark",
                                "Đã duyệt" => "badge bg-success",
                                "Từ chối" => "badge bg-danger",
                                _ => "badge bg-secondary"
                            };
                        }

                        <span class="@badgeClass">@item.Trangthai</span>
                    </p>

                    <div class="mt-3 d-flex gap-2">
                        <a href="/HoSoThiSinh/Details/@item.HosoId"
                           class="btn btn-outline-primary btn-sm">
                            Chi tiết
                        </a>

                        @if (item.ChoPhepChinhSua)
                        {
                            <a href="/HoSoThiSinh/Edit/@item.HosoId"
                               class="btn btn-outline-warning btn-sm">
                                Chỉnh sửa
                            </a>
                        }

                        @if (item.ChoPhepXoa)
                        {
                            <form asp-action="Delete"
                                  asp-route-id="@item.HosoId"
                                  method="post"
                                  onsubmit="return confirm('Bạn chắc chắn muốn xóa hồ sơ này?');">
                                <button type="submit" class="btn btn-outline-danger btn-sm">
                                    Xóa
                                </button>
                            </form>
                        }
                    </div>

                </div>
            </div>
        </div>
    }
</div>
